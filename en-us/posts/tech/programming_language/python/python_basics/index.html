<!doctype html><html lang=en-us dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Python | Jun's Blog</title><meta name=keywords content><meta name=description content="Concurrency in Python
Parallelism consists of performing multiple operations at the same time. Multiprocessing is a means to effect parallelism, and it entails spreading tasks over a computer‚Äôs central processing units (CPUs, or cores). Multiprocessing is well-suited for CPU-bound tasks: tightly bound for loops and mathematical computations usually fall into this category.
Concurrency is a slightly broader term than parallelism. It suggests that multiple tasks have the ability to run in an overlapping manner. (There‚Äôs a saying that concurrency does not imply parallelism.)
Threading is a concurrent execution model whereby multiple threads take turns executing tasks. One process can contain multiple threads. Python has a complicated relationship with threading thanks to its GIL, but that‚Äôs beyond the scope of this article."><meta name=author content="Jun"><link rel=canonical href=https://rich-junwang.github.io/en-us/posts/tech/programming_language/python/python_basics/><link crossorigin=anonymous href=../../../../../../assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=../../../../../../assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://rich-junwang.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://rich-junwang.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://rich-junwang.github.io/img/Q.gif><link rel=apple-touch-icon href=https://rich-junwang.github.io/img/Q.gif><link rel=mask-icon href=https://rich-junwang.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en-us href=https://rich-junwang.github.io/en-us/posts/tech/programming_language/python/python_basics/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Python"><meta property="og:description" content="Concurrency in Python
Parallelism consists of performing multiple operations at the same time. Multiprocessing is a means to effect parallelism, and it entails spreading tasks over a computer‚Äôs central processing units (CPUs, or cores). Multiprocessing is well-suited for CPU-bound tasks: tightly bound for loops and mathematical computations usually fall into this category.
Concurrency is a slightly broader term than parallelism. It suggests that multiple tasks have the ability to run in an overlapping manner. (There‚Äôs a saying that concurrency does not imply parallelism.)
Threading is a concurrent execution model whereby multiple threads take turns executing tasks. One process can contain multiple threads. Python has a complicated relationship with threading thanks to its GIL, but that‚Äôs beyond the scope of this article."><meta property="og:type" content="article"><meta property="og:url" content="https://rich-junwang.github.io/en-us/posts/tech/programming_language/python/python_basics/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-04-09T12:01:14-07:00"><meta property="article:modified_time" content="2015-04-09T12:01:14-07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python"><meta name=twitter:description content="Concurrency in Python
Parallelism consists of performing multiple operations at the same time. Multiprocessing is a means to effect parallelism, and it entails spreading tasks over a computer‚Äôs central processing units (CPUs, or cores). Multiprocessing is well-suited for CPU-bound tasks: tightly bound for loops and mathematical computations usually fall into this category.
Concurrency is a slightly broader term than parallelism. It suggests that multiple tasks have the ability to run in an overlapping manner. (There‚Äôs a saying that concurrency does not imply parallelism.)
Threading is a concurrent execution model whereby multiple threads take turns executing tasks. One process can contain multiple threads. Python has a complicated relationship with threading thanks to its GIL, but that‚Äôs beyond the scope of this article."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"üìöArticles","item":"https://rich-junwang.github.io/en-us/posts/"},{"@type":"ListItem","position":2,"name":"üë®üèª‚Äçüíª Tech","item":"https://rich-junwang.github.io/en-us/posts/tech/"},{"@type":"ListItem","position":3,"name":"Python","item":"https://rich-junwang.github.io/en-us/posts/tech/programming_language/python/python_basics/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Python","name":"Python","description":"Concurrency in Python Parallelism consists of performing multiple operations at the same time. Multiprocessing is a means to effect parallelism, and it entails spreading tasks over a computer‚Äôs central processing units (CPUs, or cores). Multiprocessing is well-suited for CPU-bound tasks: tightly bound for loops and mathematical computations usually fall into this category.\nConcurrency is a slightly broader term than parallelism. It suggests that multiple tasks have the ability to run in an overlapping manner. (There‚Äôs a saying that concurrency does not imply parallelism.)\nThreading is a concurrent execution model whereby multiple threads take turns executing tasks. One process can contain multiple threads. Python has a complicated relationship with threading thanks to its GIL, but that‚Äôs beyond the scope of this article.\n","keywords":[],"articleBody":"Concurrency in Python Parallelism consists of performing multiple operations at the same time. Multiprocessing is a means to effect parallelism, and it entails spreading tasks over a computer‚Äôs central processing units (CPUs, or cores). Multiprocessing is well-suited for CPU-bound tasks: tightly bound for loops and mathematical computations usually fall into this category.\nConcurrency is a slightly broader term than parallelism. It suggests that multiple tasks have the ability to run in an overlapping manner. (There‚Äôs a saying that concurrency does not imply parallelism.)\nThreading is a concurrent execution model whereby multiple threads take turns executing tasks. One process can contain multiple threads. Python has a complicated relationship with threading thanks to its GIL, but that‚Äôs beyond the scope of this article.\nWhat‚Äôs important to know about threading is that it‚Äôs better for IO-bound tasks. While a CPU-bound task is characterized by the computer‚Äôs cores continually working hard from start to finish, an IO-bound job is dominated by a lot of waiting on input/output to complete.\nTo recap the above, concurrency encompasses both multiprocessing (ideal for CPU-bound tasks) and threading (suited for IO-bound tasks). Multiprocessing is a form of parallelism, with parallelism being a specific type (subset) of concurrency. The Python standard library has offered longstanding support for both of these through its multiprocessing, threading, and concurrent.futures packages.\nShared Memory Why We Use Shared Memory?\nWhen using Python for parallel processing, performance may not always scale as expected‚Äîespecially due to how data is shared between tasks. Here‚Äôs why:\nThreading Python threads share the same memory space, making data sharing straightforward. However, due to the Global Interpreter Lock (GIL), threads are best suited for I/O-bound operations‚Äînot CPU-intensive workloads.\nMultiprocessing In contrast, the multiprocessing module spawns separate processes, each with its own memory space. Sharing data between processes requires serialization via Queue, Pipe, or similar mechanisms. This copying and (de)serialization introduce significant communication overhead, which can negate performance gains.\nA Better Approach: Shared Memory To reduce inter-process communication overhead, shared memory allows multiple processes to access the same memory block directly. This eliminates the need for serialization and copying, enabling much faster data exchange and improved scalability for CPU-bound tasks. If you‚Äôre hitting performance bottlenecks with multiprocessing, consider using multiprocessing.shared_memory for efficient, zero-copy data sharing.\nfrom multiprocessing import Process, shared_memory import numpy as np def worker(shm_name, size): \"\"\"Process that modifies shared memory\"\"\" existing_shm = shared_memory.SharedMemory(name=shm_name) array = np.ndarray((size,), dtype=np.float64, buffer=existing_shm.buf) array += 10 # Modify data in shared memory existing_shm.close() if __name__ == \"__main__\": size = 5 shm = shared_memory.SharedMemory(create=True, size=size * np.float64().nbytes) array = np.ndarray((size,), dtype=np.float64, buffer=shm.buf) array[:] = [1, 2, 3, 4, 5] # Initialize array print(\"Before:\", array) # Create a process that modifies shared memory p = Process(target=worker, args=(shm.name, size)) p.start() p.join() print(\"After:\", array) # Values modified by worker process # Cleanup shm.close() shm.unlink() Note that when aloocating memory, the unit is byte. The allocation such as shown below would create 1MB memory.\nshm = SharedMemory(name=\"myshm\", create=True, size=2**20) update python on ubuntu When there are multiple version of python in the system, how to set the default python to use. Below we suppose to install newer version of python3.9\nsudo apt install python3.9 sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.[old-version] 1 sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.9 2 #after the following command, select the new version when being prompted and press enter sudo update-alternatives --config python3 # There is a simpler way. From system admin perspective, this is not scalable. sudo ln -sf /usr/bin/python3.9 /usr/bin/python3 find a python package related files pip show -f package-name pip list | grep kafka Find out python binry file path \u003e\u003e\u003e import streamlit \u003e\u003e\u003e print(streamlit.__file__) Process Got Killed Once in a while, I found my python process got killed without any errors. Most of time, it‚Äôs related to out of memory (OOM) issue. We can quickly check that using the following command\ndmesg | grep \"oom-kill\" | less Virtual Env python3 -m pip install --upgrade pip python3 -m pip install --user virtualenv python3 -m venv .venv source .venv/bin/activate # exit deactivate Debug # using pdb # use `n` to step over # use `s` to step into # use `ll` to check current lines # see more here: https://realpython.com/python-debugging-pdb/ import pdb; pdb.set_trace() # using ipdb if torch.distributed.get_rank() == 0: import ipdb; ipdb.set_trace() # using ipdb. Program will enter ipython at the exception from ipdb import launch_ipdb_on_exception def filter_even(nums): for i in range(len(nums)): if nums[i] % 2 == 0: del nums[i] with launch_ipdb_on_exception(): print(filter_even(list(range(6)))) # we can check internal stack, `i`, `nums` etc and can also execute the next step. # We can also use the following way. The program will error out and enter ipdb. import sys from IPython.core import ultratb sys.excepthook = ultratb.FormattedTB(call_pdb=1) def filter_even(nums): for i in range(len(nums)): if nums[i] % 2 == 0: del nums[i] filter_even(list(range(6))) Exception How to catch generic exception type\ntry: someFunction() except Exception as ex: template = \"An exception of type {0} occurred. Arguments:\\n{1!r}\" message = template.format(type(ex).__name__, ex.args) print(message) The difference between the above and using just except without any argument is twofold: (1) A bare except doesn‚Äôt give you the exception object to inspect (2) The exceptions SystemExit, KeyboardInterrupt and GeneratorExit aren‚Äôt caught by the above code, which is generally what you want.\nIf you also want the same stacktrace you get if you do not catch the exception, you can get that like this (still inside the except clause):\nimport traceback print(traceback.format_exc()) # or traceback.print_exc() If you use the logging module, you can print the exception to the log (along with a message) like this:\nimport logging log = logging.getLogger() log.exception(\"Message for you, sir!\") To dig deeper and examine the stack, look at variables etc., use the post_mortem function of the pdb module inside the except block:\nimport pdb pdb.post_mortem() new method The new() is a static method of the object class. When you create a new object by calling the class, Python calls the new() method to create the object first and then calls the init() method to initialize the object‚Äôs attributes. Override the new() method if you want to tweak the object at creation time. Hacky Way to Add File into PYTHONPATH curr_file_path = os.path.dirname(os.path.abspath(os.path.expanduser(__file__))) sys.path.append(curr_file_path) sys.path.append(os.path.dirname(curr_file_path)) Subprocess import subprocess # Download dl = subprocess.Popen([\"git\", \"clone\", str(repo_path), str(repo_dir)]) # It also accepts str as the input command output_path = \"my_out\" cmd = \"\"\"python3 train.py --local-rank 0\"\"\" proc = subprocess.Popen( cmd, stdout=subprocess.PIPE, stderr=open(f\"{output_path}.stderr\", \"wt\", encoding=\"utf-8\"), shell=True, encoding='utf-8', bufsize=0) Dataclass Data classes use something called a default_factory to handle mutable default values. To use default_factory, we need to use the field() specifier.\nfrom dataclasses import dataclass, field from typing import List RANKS = '2 3 4 5 6 7 8 9 10 J Q K A'.split() SUITS = '‚ô£ ‚ô¢ ‚ô° ‚ô†'.split() def make_french_deck(): return [PlayingCard(r, s) for s in SUITS for r in RANKS] @dataclass class Deck: # we can't do the following way to assign a mutable default value to a field. # cards: List[PlayingCard] = make_french_deck() cards: List[PlayingCard] = field(default_factory=make_french_deck) A few commonly used parameters that field supports\ndefault: Default value of the field default_factory: Function that returns the initial value of the field init: Use field in .init() method? (Default is True.) repr: Use field in repr of the object? (Default is True.) Global Variable in Python Python looks for variables in four different scopes:\nThe local, or function-level, scope, which exists inside functions The enclosing, or non-local, scope, which appears in nested functions The global scope, which exists at the module level The built-in scope, which is a special scope for Python‚Äôs built-in names The code snippet below shows how these scopes work.\n# Global scope def outer_func(): # Non-local scope def inner_func(): # Local scope print(some_variable) inner_func() Notice that global is only at module level. There is no program level global variable for python. After we define a global variable in one module, we could use it in other module with its module name.\nUV Right now, my workflow with UV is to maintain a shared virtual environment. That way, I don‚Äôt have to reinstall packages for every single project, and I can still use the Python interpreter to run code directly on my local setup. For some tools, I lean on uv tool to handle the installation. I only spin up dedicated virtual environments when a project‚Äôs dependencies look like they could get messy.\n# show all pythons available uv python list # fix python for uv uv python pin 3.12 # create shared env uv venv ~/.uv/shared --python 3.12 source ~/.uv/shared/bin/activate alias shared='source ~/.uv/shared/bin/activate' alias dev='source ~/.uv/dev/bin/activate' alias local='source .venv/bin/activate' # install through pip after running shared command (aliased above) uv pip install pandas # install common tools with uv tool uv tool install mytool Other Common Usages # install pip install uv # Add the following line to zshrc or bashrc after pip install to get the binary in PATH # export PATH=`python3 -m site --user-base`/bin:\\$PATH # initialize a project uv init # create virtual env uv venv uv venv .my_venv_path # specify python version in venv uv venv -p 3.11 uv venv -python 3.11 source .my_venv_path/bin/activate # install packages using uv uv pip install pandas # update package uv pip install -U pandas # install from local directory uv pip install . # install from local, support editable uv pip install -e . # uninstall uv pip uninstall pandas # uv get package versions uv pip compile my_packages.txt -o requirements.txt uv pip compile - -o requirements.txt uv pip sync requirements.txt uv cache prune uv cache clean Python Development Mode pip install -e path/to/SomeProject Editable installs allow you to install your project without copying any files. Instead, the files in the development directory are added to Python‚Äôs import path. This approach is well suited for development and is also known as a ‚Äúdevelopment installation‚Äù.\nReferences https://realpython.com/python-data-classes/ https://realpython.com/python-debugging-pdb/ ","wordCount":"1774","inLanguage":"en-us","datePublished":"2015-04-09T12:01:14-07:00","dateModified":"2015-04-09T12:01:14-07:00","author":[{"@type":"Person","name":"Jun"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://rich-junwang.github.io/en-us/posts/tech/programming_language/python/python_basics/"},"publisher":{"@type":"Organization","name":"Jun's Blog","logo":{"@type":"ImageObject","url":"https://rich-junwang.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://rich-junwang.github.io/en-us/ accesskey=h title="Jun's Blog (Alt + H)"><img src=https://rich-junwang.github.io/img/Q.gif alt=logo aria-label=logo height=35>Jun's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://rich-junwang.github.io/en-us/ title="üè† Home"><span>üè† Home</span></a></li><li><a href=https://rich-junwang.github.io/en-us/about title="üôãüèª‚Äç‚ôÇÔ∏è About"><span>üôãüèª‚Äç‚ôÇÔ∏è About</span></a></li><li><a href=https://rich-junwang.github.io/en-us/posts title="üìö Posts"><span>üìö Posts</span></a></li><li><a href=https://rich-junwang.github.io/en-us/tags title="üß© Tags"><span>üß© Tags</span></a></li><li><a href=https://rich-junwang.github.io/en-us/archives/ title="‚è±Ô∏è Archives"><span>‚è±Ô∏è Archives</span></a></li><li><a href=https://rich-junwang.github.io/en-us/search title="üîç Search (Alt + /)" accesskey=/><span>üîç Search</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://rich-junwang.github.io/en-us/>üè† Home</a>&nbsp;¬ª&nbsp;<a href=https://rich-junwang.github.io/en-us/posts/>üìöArticles</a>&nbsp;¬ª&nbsp;<a href=https://rich-junwang.github.io/en-us/posts/tech/>üë®üèª‚Äçüíª Tech</a></div><h1 class=post-title>Python</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2015-04-09
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>1774 words
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>4 min
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>Jun
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://rich-junwang.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#concurrency-in-python aria-label="Concurrency in Python">Concurrency in Python</a><ul><li><a href=#shared-memory aria-label="Shared Memory">Shared Memory</a></li></ul></li><li><a href=#update-python-on-ubuntu aria-label="update python on ubuntu">update python on ubuntu</a></li><li><a href=#find-a-python-package-related-files aria-label="find a python package related files">find a python package related files</a><ul><li><a href=#find-out-python-binry-file-path aria-label="Find out python binry file path">Find out python binry file path</a></li></ul></li><li><a href=#process-got-killed aria-label="Process Got Killed">Process Got Killed</a></li><li><a href=#virtual-env aria-label="Virtual Env">Virtual Env</a></li><li><a href=#debug aria-label=Debug>Debug</a></li><li><a href=#exception aria-label=Exception>Exception</a></li><li><a href=#new-method aria-label="new method">new method</a></li><li><a href=#hacky-way-to-add-file-into-pythonpath aria-label="Hacky Way to Add File into PYTHONPATH">Hacky Way to Add File into PYTHONPATH</a></li><li><a href=#subprocess aria-label=Subprocess>Subprocess</a></li><li><a href=#dataclass aria-label=Dataclass>Dataclass</a></li><li><a href=#global-variable-in-python aria-label="Global Variable in Python">Global Variable in Python</a></li><li><a href=#uv aria-label=UV>UV</a><ul><li><a href=#other-common-usages aria-label="Other Common Usages">Other Common Usages</a></li></ul></li><li><a href=#python-development-mode aria-label="Python Development Mode">Python Development Mode</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=concurrency-in-python>Concurrency in Python<a hidden class=anchor aria-hidden=true href=#concurrency-in-python>#</a></h2><p>Parallelism consists of performing multiple operations at the same time. Multiprocessing is a means to effect parallelism, and it entails spreading tasks over a computer‚Äôs central processing units (CPUs, or cores). Multiprocessing is well-suited for CPU-bound tasks: tightly bound for loops and mathematical computations usually fall into this category.</p><p>Concurrency is a slightly broader term than parallelism. It suggests that multiple tasks have the ability to run in an overlapping manner. (There‚Äôs a saying that concurrency does not imply parallelism.)</p><p>Threading is a concurrent execution model whereby multiple threads take turns executing tasks. One process can contain multiple threads. Python has a complicated relationship with threading thanks to its GIL, but that‚Äôs beyond the scope of this article.</p><p>What‚Äôs important to know about threading is that it‚Äôs better for IO-bound tasks. While a CPU-bound task is characterized by the computer‚Äôs cores continually working hard from start to finish, an IO-bound job is dominated by a lot of waiting on input/output to complete.</p><p>To recap the above, concurrency encompasses both multiprocessing (ideal for CPU-bound tasks) and threading (suited for IO-bound tasks). Multiprocessing is a form of parallelism, with parallelism being a specific type (subset) of concurrency. The Python standard library has offered longstanding support for both of these through its multiprocessing, threading, and concurrent.futures packages.</p><h3 id=shared-memory>Shared Memory<a hidden class=anchor aria-hidden=true href=#shared-memory>#</a></h3><p><strong>Why We Use Shared Memory?</strong></p><p>When using Python for parallel processing, performance may not always scale as expected‚Äîespecially due to how data is shared between tasks. Here&rsquo;s why:</p><ul><li>Threading</li></ul><p>Python threads share the same memory space, making data sharing straightforward. However, due to the Global Interpreter Lock (GIL), threads are best suited for I/O-bound operations‚Äînot CPU-intensive workloads.</p><ul><li>Multiprocessing</li></ul><p>In contrast, the multiprocessing module spawns separate processes, each with its own memory space. Sharing data between processes requires serialization via Queue, Pipe, or similar mechanisms. This copying and (de)serialization introduce significant communication overhead, which can negate performance gains.</p><ul><li>A Better Approach: Shared Memory</li></ul><p>To reduce inter-process communication overhead, shared memory allows multiple processes to access the same memory block directly. This eliminates the need for serialization and copying, enabling much faster data exchange and improved scalability for CPU-bound tasks. If you&rsquo;re hitting performance bottlenecks with multiprocessing, consider using multiprocessing.shared_memory for efficient, zero-copy data sharing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> multiprocessing <span style=color:#f92672>import</span> Process, shared_memory
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>worker</span>(shm_name, size):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Process that modifies shared memory&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    existing_shm <span style=color:#f92672>=</span> shared_memory<span style=color:#f92672>.</span>SharedMemory(name<span style=color:#f92672>=</span>shm_name)
</span></span><span style=display:flex><span>    array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>ndarray((size,), dtype<span style=color:#f92672>=</span>np<span style=color:#f92672>.</span>float64, buffer<span style=color:#f92672>=</span>existing_shm<span style=color:#f92672>.</span>buf)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    array <span style=color:#f92672>+=</span> <span style=color:#ae81ff>10</span>  <span style=color:#75715e># Modify data in shared memory</span>
</span></span><span style=display:flex><span>    existing_shm<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    shm <span style=color:#f92672>=</span> shared_memory<span style=color:#f92672>.</span>SharedMemory(create<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, size<span style=color:#f92672>=</span>size <span style=color:#f92672>*</span> np<span style=color:#f92672>.</span>float64()<span style=color:#f92672>.</span>nbytes)
</span></span><span style=display:flex><span>    array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>ndarray((size,), dtype<span style=color:#f92672>=</span>np<span style=color:#f92672>.</span>float64, buffer<span style=color:#f92672>=</span>shm<span style=color:#f92672>.</span>buf)
</span></span><span style=display:flex><span>    array[:] <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>]  <span style=color:#75715e># Initialize array</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Before:&#34;</span>, array)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create a process that modifies shared memory</span>
</span></span><span style=display:flex><span>    p <span style=color:#f92672>=</span> Process(target<span style=color:#f92672>=</span>worker, args<span style=color:#f92672>=</span>(shm<span style=color:#f92672>.</span>name, size))
</span></span><span style=display:flex><span>    p<span style=color:#f92672>.</span>start()
</span></span><span style=display:flex><span>    p<span style=color:#f92672>.</span>join()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;After:&#34;</span>, array)  <span style=color:#75715e># Values modified by worker process</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Cleanup</span>
</span></span><span style=display:flex><span>    shm<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>    shm<span style=color:#f92672>.</span>unlink()
</span></span></code></pre></div><p>Note that when aloocating memory, the unit is byte. The allocation such as shown below would create 1MB memory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>shm <span style=color:#f92672>=</span> SharedMemory(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;myshm&#34;</span>, create<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, size<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>20</span>) 
</span></span></code></pre></div><h2 id=update-python-on-ubuntu>update python on ubuntu<a hidden class=anchor aria-hidden=true href=#update-python-on-ubuntu>#</a></h2><p>When there are multiple version of python in the system, how to set the default python to use. Below we suppose to install newer version of python3.9</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install python3.9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.<span style=color:#f92672>[</span>old-version<span style=color:#f92672>]</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.9 <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#after the following command, select the new version when being prompted and press enter</span>
</span></span><span style=display:flex><span>sudo update-alternatives --config python3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># There is a simpler way. From system admin perspective, this is not scalable.</span>
</span></span><span style=display:flex><span>sudo ln -sf /usr/bin/python3.9 /usr/bin/python3
</span></span></code></pre></div><h2 id=find-a-python-package-related-files>find a python package related files<a hidden class=anchor aria-hidden=true href=#find-a-python-package-related-files>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>pip show -f package-name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pip list | grep kafka
</span></span></code></pre></div><h3 id=find-out-python-binry-file-path>Find out python binry file path<a hidden class=anchor aria-hidden=true href=#find-out-python-binry-file-path>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>import</span> streamlit
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> print(streamlit<span style=color:#f92672>.</span>__file__)
</span></span></code></pre></div><h2 id=process-got-killed>Process Got Killed<a hidden class=anchor aria-hidden=true href=#process-got-killed>#</a></h2><p>Once in a while, I found my python process got killed without any errors. Most of time, it&rsquo;s related to out of memory (OOM) issue. We can quickly check that using the following command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>dmesg | grep &#34;oom-kill&#34; | less
</span></span></code></pre></div><h2 id=virtual-env>Virtual Env<a hidden class=anchor aria-hidden=true href=#virtual-env>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -m pip install --upgrade pip
</span></span><span style=display:flex><span>python3 -m pip install --user virtualenv
</span></span><span style=display:flex><span>python3 -m venv .venv
</span></span><span style=display:flex><span>source .venv/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># exit</span>
</span></span><span style=display:flex><span>deactivate
</span></span></code></pre></div><h2 id=debug>Debug<a hidden class=anchor aria-hidden=true href=#debug>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># using pdb</span>
</span></span><span style=display:flex><span><span style=color:#75715e># use `n` to step over</span>
</span></span><span style=display:flex><span><span style=color:#75715e># use `s` to step into</span>
</span></span><span style=display:flex><span><span style=color:#75715e># use `ll` to check current lines</span>
</span></span><span style=display:flex><span><span style=color:#75715e># see more here: https://realpython.com/python-debugging-pdb/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pdb; pdb<span style=color:#f92672>.</span>set_trace()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># using ipdb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> torch<span style=color:#f92672>.</span>distributed<span style=color:#f92672>.</span>get_rank() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> ipdb; ipdb<span style=color:#f92672>.</span>set_trace()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># using ipdb. Program will enter ipython at the exception</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> ipdb <span style=color:#f92672>import</span> launch_ipdb_on_exception
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_even</span>(nums):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(nums)):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> nums[i] <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>del</span> nums[i]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> launch_ipdb_on_exception():
</span></span><span style=display:flex><span>    print(filter_even(list(range(<span style=color:#ae81ff>6</span>))))
</span></span><span style=display:flex><span><span style=color:#75715e># we can check internal stack, `i`, `nums` etc and can also execute the next step. </span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e># We can also use the following way. The program will error out and enter ipdb.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> IPython.core <span style=color:#f92672>import</span> ultratb
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>excepthook <span style=color:#f92672>=</span> ultratb<span style=color:#f92672>.</span>FormattedTB(call_pdb<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_even</span>(nums):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(nums)):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> nums[i] <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>del</span> nums[i]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filter_even(list(range(<span style=color:#ae81ff>6</span>)))
</span></span></code></pre></div><h2 id=exception>Exception<a hidden class=anchor aria-hidden=true href=#exception>#</a></h2><p>How to catch generic exception type</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    someFunction()
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> ex:
</span></span><span style=display:flex><span>    template <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;An exception of type </span><span style=color:#e6db74>{0}</span><span style=color:#e6db74> occurred. Arguments:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{1!r}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    message <span style=color:#f92672>=</span> template<span style=color:#f92672>.</span>format(type(ex)<span style=color:#f92672>.</span>__name__, ex<span style=color:#f92672>.</span>args)
</span></span><span style=display:flex><span>    print(message)
</span></span></code></pre></div><p>The difference between the above and using just <code>except</code> without any argument is twofold: (1) A bare except doesn&rsquo;t give you the exception object to inspect (2) The exceptions SystemExit, KeyboardInterrupt and GeneratorExit aren&rsquo;t caught by the above code, which is generally what you want.</p><p>If you also want the same stacktrace you get if you do not catch the exception, you can get that like this (still inside the except clause):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> traceback
</span></span><span style=display:flex><span>print(traceback<span style=color:#f92672>.</span>format_exc())
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>traceback<span style=color:#f92672>.</span>print_exc()
</span></span></code></pre></div><p>If you use the logging module, you can print the exception to the log (along with a message) like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>log <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger()
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>exception(<span style=color:#e6db74>&#34;Message for you, sir!&#34;</span>)
</span></span></code></pre></div><p>To dig deeper and examine the stack, look at variables etc., use the post_mortem function of the pdb module inside the except block:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pdb
</span></span><span style=display:flex><span>pdb<span style=color:#f92672>.</span>post_mortem()
</span></span></code></pre></div><h2 id=new-method>new method<a hidden class=anchor aria-hidden=true href=#new-method>#</a></h2><ul><li>The <strong>new</strong>() is a static method of the object class.</li><li>When you create a new object by calling the class, Python calls the <strong>new</strong>() method to create the object first and then calls the <strong>init</strong>() method to initialize the object‚Äôs attributes.</li><li>Override the <strong>new</strong>() method if you want to tweak the object at creation time.</li></ul><h2 id=hacky-way-to-add-file-into-pythonpath>Hacky Way to Add File into PYTHONPATH<a hidden class=anchor aria-hidden=true href=#hacky-way-to-add-file-into-pythonpath>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>curr_file_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>abspath(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>expanduser(__file__)))
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>append(curr_file_path)
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>append(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(curr_file_path))
</span></span></code></pre></div><h2 id=subprocess>Subprocess<a hidden class=anchor aria-hidden=true href=#subprocess>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#75715e># Download</span>
</span></span><span style=display:flex><span>dl <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>Popen([<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;clone&#34;</span>, str(repo_path), str(repo_dir)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># It also accepts str as the input command</span>
</span></span><span style=display:flex><span>output_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my_out&#34;</span>
</span></span><span style=display:flex><span>cmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;python3 train.py --local-rank 0&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>proc <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>Popen(
</span></span><span style=display:flex><span>    cmd,
</span></span><span style=display:flex><span>    stdout<span style=color:#f92672>=</span>subprocess<span style=color:#f92672>.</span>PIPE,
</span></span><span style=display:flex><span>    stderr<span style=color:#f92672>=</span>open(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>output_path<span style=color:#e6db74>}</span><span style=color:#e6db74>.stderr&#34;</span>, <span style=color:#e6db74>&#34;wt&#34;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>),
</span></span><span style=display:flex><span>    shell<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>,
</span></span><span style=display:flex><span>    bufsize<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><h2 id=dataclass>Dataclass<a hidden class=anchor aria-hidden=true href=#dataclass>#</a></h2><p>Data classes use something called a default_factory to handle mutable default values. To use default_factory, we need to use the field() specifier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dataclasses <span style=color:#f92672>import</span> dataclass, field
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RANKS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2 3 4 5 6 7 8 9 10 J Q K A&#39;</span><span style=color:#f92672>.</span>split()
</span></span><span style=display:flex><span>SUITS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;‚ô£ ‚ô¢ ‚ô° ‚ô†&#39;</span><span style=color:#f92672>.</span>split()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>make_french_deck</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [PlayingCard(r, s) <span style=color:#66d9ef>for</span> s <span style=color:#f92672>in</span> SUITS <span style=color:#66d9ef>for</span> r <span style=color:#f92672>in</span> RANKS]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Deck</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># we can&#39;t do the following way to assign a mutable default value to a field. </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># cards: List[PlayingCard] = make_french_deck()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cards: List[PlayingCard] <span style=color:#f92672>=</span> field(default_factory<span style=color:#f92672>=</span>make_french_deck)
</span></span></code></pre></div><p>A few commonly used parameters that field supports</p><ul><li>default: Default value of the field</li><li>default_factory: Function that returns the initial value of the field</li><li>init: Use field in .<strong>init</strong>() method? (Default is True.)</li><li>repr: Use field in repr of the object? (Default is True.)</li></ul><h2 id=global-variable-in-python>Global Variable in Python<a hidden class=anchor aria-hidden=true href=#global-variable-in-python>#</a></h2><p>Python looks for variables in four different scopes:</p><blockquote><ol><li>The local, or function-level, scope, which exists inside functions</li><li>The enclosing, or non-local, scope, which appears in nested functions</li><li>The global scope, which exists at the module level</li><li>The built-in scope, which is a special scope for Python‚Äôs built-in names</li></ol></blockquote><p>The code snippet below shows how these scopes work.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Global scope</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>outer_func</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># Non-local scope</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>inner_func</span>():
</span></span><span style=display:flex><span>        <span style=color:#75715e># Local scope</span>
</span></span><span style=display:flex><span>        print(some_variable)
</span></span><span style=display:flex><span>    inner_func()
</span></span></code></pre></div><p>Notice that global is only at module level. There is no program level global variable for python. After we define a global variable in one module, we could use it in other module with its module name.</p><h2 id=uv>UV<a hidden class=anchor aria-hidden=true href=#uv>#</a></h2><p>Right now, my workflow with UV is to maintain a shared virtual environment. That way, I don‚Äôt have to reinstall packages for every single project, and I can still use the Python interpreter to run code directly on my local setup. For some tools, I lean on uv tool to handle the installation. I only spin up dedicated virtual environments when a project‚Äôs dependencies look like they could get messy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># show all pythons available</span>
</span></span><span style=display:flex><span>uv python list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># fix python for uv</span>
</span></span><span style=display:flex><span>uv python pin 3.12
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create shared env</span>
</span></span><span style=display:flex><span>uv venv ~/.uv/shared --python 3.12
</span></span><span style=display:flex><span>source ~/.uv/shared/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>alias shared<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;source ~/.uv/shared/bin/activate&#39;</span> 
</span></span><span style=display:flex><span>alias dev<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;source ~/.uv/dev/bin/activate&#39;</span> 
</span></span><span style=display:flex><span>alias local<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;source .venv/bin/activate&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install through pip after running shared command (aliased above) </span>
</span></span><span style=display:flex><span>uv pip install pandas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install common tools with uv tool</span>
</span></span><span style=display:flex><span>uv tool install mytool
</span></span></code></pre></div><h3 id=other-common-usages>Other Common Usages<a hidden class=anchor aria-hidden=true href=#other-common-usages>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install</span>
</span></span><span style=display:flex><span>pip install uv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add the following line to zshrc or bashrc after pip install to get the binary in PATH</span>
</span></span><span style=display:flex><span><span style=color:#75715e># export PATH=`python3 -m site --user-base`/bin:\$PATH</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># initialize a project</span>
</span></span><span style=display:flex><span>uv init
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create virtual env</span>
</span></span><span style=display:flex><span>uv venv
</span></span><span style=display:flex><span>uv venv .my_venv_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specify python version in venv</span>
</span></span><span style=display:flex><span>uv venv -p 3.11
</span></span><span style=display:flex><span>uv venv -python 3.11
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>source .my_venv_path/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install packages using uv</span>
</span></span><span style=display:flex><span>uv pip install pandas 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># update package</span>
</span></span><span style=display:flex><span>uv pip install -U pandas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># install from local directory</span>
</span></span><span style=display:flex><span>uv pip install .
</span></span><span style=display:flex><span><span style=color:#75715e># install from local, support editable</span>
</span></span><span style=display:flex><span>uv pip install -e .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># uninstall </span>
</span></span><span style=display:flex><span>uv pip uninstall pandas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># uv get package versions</span>
</span></span><span style=display:flex><span>uv pip compile my_packages.txt -o requirements.txt
</span></span><span style=display:flex><span>uv pip compile - -o requirements.txt
</span></span><span style=display:flex><span>uv pip sync requirements.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>uv cache prune
</span></span><span style=display:flex><span>uv cache clean
</span></span></code></pre></div><h2 id=python-development-mode>Python Development Mode<a hidden class=anchor aria-hidden=true href=#python-development-mode>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install -e path/to/SomeProject
</span></span></code></pre></div><p>Editable installs allow you to install your project without copying any files. Instead, the files in the development directory are added to Python‚Äôs import path. This approach is well suited for development and is also known as a ‚Äúdevelopment installation‚Äù.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ol><li><a href=https://realpython.com/python-data-classes/>https://realpython.com/python-data-classes/</a></li><li><a href=https://realpython.com/python-debugging-pdb/>https://realpython.com/python-debugging-pdb/</a></li></ol></div><footer class=post-footer><nav class=paginav><a class=prev href=https://rich-junwang.github.io/en-us/posts/tech/web/forward_reverse_proxy/><span class=title>¬´</span><br><span>Basics of Web</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Python on twitter" href="https://twitter.com/intent/tweet/?text=Python&amp;url=https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f&amp;hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Python on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f&amp;title=Python&amp;summary=Python&amp;source=https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Python on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f&title=Python"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Python on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Python on whatsapp" href="https://api.whatsapp.com/send?text=Python%20-%20https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Python on telegram" href="https://telegram.me/share/url?text=Python&amp;url=https%3a%2f%2frich-junwang.github.io%2fen-us%2fposts%2ftech%2fprogramming_language%2fpython%2fpython_basics%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><style>.comments_details summary::marker{font-size:20px;content:'üëâComment';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'üëáCollapse';color:var(--content)}</style><div><details class=comments_details><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>twikoo.init({envId:null,el:"#tcomment",lang:"en-us",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2025
<a href=https://rich-junwang.github.io/en-us/ style=color:#939393>Jun's Blog</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`\r

‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\r
ÁâàÊùÉÂ£∞ÊòéÔºöÊú¨Êñá‰∏∫„ÄåJun's Blog„ÄçÁöÑÂéüÂàõÊñáÁ´†ÔºåÈÅµÂæ™CC 4.0 BY-SAÁâàÊùÉÂçèËÆÆÔºåËΩ¨ËΩΩËØ∑ÈôÑ‰∏äÂéüÊñáÂá∫Â§ÑÈìæÊé•ÂèäÊú¨Â£∞Êòé„ÄÇ\r
ÂéüÊñáÈìæÊé•Ôºö`+location.href,s=window.getSelection().toString()+`\r

‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\r
ÁâàÊùÉÂ£∞ÊòéÔºöÊú¨Êñá‰∏∫„ÄåJun's Blog„ÄçÁöÑÂéüÂàõÊñáÁ´†ÔºåÈÅµÂæ™CC 4.0 BY-SAÁâàÊùÉÂçèËÆÆÔºåËΩ¨ËΩΩËØ∑ÈôÑ‰∏äÂéüÊñáÂá∫Â§ÑÈìæÊé•ÂèäÊú¨Â£∞Êòé„ÄÇ\r
ÂéüÊñáÈìæÊé•Ôºö`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function i(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`\r
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\r
ÁâàÊùÉÂ£∞ÊòéÔºöÊú¨Êñá‰∏∫„ÄåJun's Blog„ÄçÁöÑÂéüÂàõÊñáÁ´†ÔºåÈÅµÂæ™CC 4.0 BY-SAÁâàÊùÉÂçèËÆÆÔºåËΩ¨ËΩΩËØ∑ÈôÑ‰∏äÂéüÊñáÂá∫Â§ÑÈìæÊé•ÂèäÊú¨Â£∞Êòé„ÄÇ\r
ÂéüÊñáÈìæÊé•Ôºö`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>
<!doctype html><html lang=en-us dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes | Jun's Blog</title><meta name=keywords content><meta name=description content="Kubenetes is everywhere."><meta name=author content="Jun"><link rel=canonical href=https://rich-junwang.github.io/en-us/posts/tech/ml_infra/kubenetes/basics/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://rich-junwang.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://rich-junwang.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://rich-junwang.github.io/img/Q.gif><link rel=apple-touch-icon href=https://rich-junwang.github.io/img/Q.gif><link rel=mask-icon href=https://rich-junwang.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en-us href=https://rich-junwang.github.io/en-us/posts/tech/ml_infra/kubenetes/basics/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Kubernetes"><meta property="og:description" content="Kubenetes is everywhere."><meta property="og:type" content="article"><meta property="og:url" content="https://rich-junwang.github.io/en-us/posts/tech/ml_infra/kubenetes/basics/"><meta property="og:image" content="https://rich-junwang.github.io/images/speedup.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-08T12:01:14-07:00"><meta property="article:modified_time" content="2022-12-08T12:01:14-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rich-junwang.github.io/images/speedup.jpg"><meta name=twitter:title content="Kubernetes"><meta name=twitter:description content="Kubenetes is everywhere."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šArticles","item":"https://rich-junwang.github.io/en-us/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» Tech","item":"https://rich-junwang.github.io/en-us/posts/tech/"},{"@type":"ListItem","position":3,"name":"Kubernetes","item":"https://rich-junwang.github.io/en-us/posts/tech/ml_infra/kubenetes/basics/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes","name":"Kubernetes","description":"Kubenetes is everywhere.","keywords":[""],"articleBody":"Basics Kubernetes, also known as â€œk8sâ€, is an open source platform solution provided by Google for scheduling and automating the deployment, management, and scaling of containerized applications. Kubernetes has the ability of scheduling and running application containers on a cluster of physical or virtual machines. In managing the applications, the concepts of â€™labelsâ€™ and â€˜podsâ€™ are used to group the containers which make up an application. Currently, it supports Docker for containers.\nkubernetes architecture, image from [1] Pod is a type of abstraction on top of container. Deployment defines the pod. Deployment is used for stateless apps and StatefulSet is used for stateful apps or database. KubeCTL talks with API server to create components or delete components, in other words configuring the cluster. More about this basics is here\nBasic Operations To find out all the pods, using the following command\nkubectl get pods kubectl get pods | grep username kubectl get pods -n my_namespace_name # get pod understand a # get all the nodes kubectl get nodes # get services kubectl get services # create deployment. (blueprint of pod) kubectl create deployment my_pod_name --image=my_image kubectl get deployment kubectl delete deployment deployment_name # Log into the pod kubectl exec -it my_pod_name -- /bin/bash # describe a pod kubectl describe pods kubectl describe pod my_pod_name # get pod config kubectl get pod my_pod_name -o yaml # delete a pod kubectl delete Pod my_pod_name To get all the containers running the pod, using the following command\nkubectl get pods my_pod_name -o custom-columns='NAME:.metadata.name,CONTAINERS:.spec.containers[*].name' kubectl describe pod my_pod_name -n my_namespace_name # To get ip. The ip can be used to launch distributed runs. kubectl get pod my_pod_name --template '{{.status.podIP}}' View logs of job running in the pod\nkubectl logs my_pod_name kubectl logs -f my_pod_name # similar to attach kubectl attach my_pod_name # works with tqdm Deploy a k8s job\n# deploy kubectl apply -f ./job.yaml # delete kubectl delete -f ./job.yaml # describe kubectl describe -f ./job.yaml When we want to delete kubernetes created resources, itâ€™s important to remember the dependencies of the resources. For instance, to delete a fsx app, we have to do the following in order\nkubectl delete pod --all kubectl delete pvc --all kubectl delete pv --all We can use kubectl to copy files to/from the pod. Be careful that your container may not support ~ this kind of path expansion.\nkubectl cp src_file_path pod:dest_file_path To use rsync is not that straightforward, Iâ€™m using the tool from here.\n# save the file as krsync, and put it to /usr/bin, and chmod +x to the file #!/bin/bash if [ -z \"$KRSYNC_STARTED\" ]; then export KRSYNC_STARTED=true exec rsync --blocking-io --rsh \"$0\" $@ fi # Running as --rsh namespace='' pod=$1 shift # If use uses pod@namespace rsync passes as: {us} -l pod namespace ... if [ \"X$pod\" = \"X-l\" ]; then pod=$1 shift namespace=\"-n $1\" shift fi exec kubectl $namespace exec -i $pod -- \"$@\" Then use the following command to sync files. Note that you have to install rsync on the pod.\nkrsync -av --progress --stats src-dir/ pod:/dest-dir # with namespace krsync -av --progress --stats src-dir/ pod@namespace:/dest-dir To make it easier to use, we can add the following to the .zshrc file\nfunction krsync_watch_and_sync_to { fswatch -o . | xargs -n1 -I{} krsync -av --progress --stats *(D) $1 } Sometimes we have to change file ownership. Check out more here\nchown -R 33:33 /data/uploads When we want to log into multiple pods, we can use the following command:\nxpanes -c \"kubectl exec -it {} -- /bin/bash \" $(kubectl get pods | grep my_pod_prefixes | cut -d\" \" -f1 | tr '\\n' ' ') EKS AWS has managed kubenetes service called EKS.\n# create a basic cluster eksctl create cluster eksctl create cluster -f ./my_eks.yaml # get details of a cluster eksctl get cluster --name=\"my_cluster_1\" --region=\"us-west-2\" References Setting up a Kubernetes cluster using Docker in Docker https://kubernetes.io/docs/reference/kubectl/cheatsheet/ https://catalog.workshops.aws/sagemaker-hyperpod-eks/en-US https://catalog.workshops.aws/sagemaker-hyperpod/en-US https://github.com/aws-samples/aws-do-ray ","wordCount":"652","inLanguage":"en-us","image":"https://rich-junwang.github.io/images/speedup.jpg","datePublished":"2022-12-08T12:01:14-07:00","dateModified":"2022-12-08T12:01:14-07:00","author":[{"@type":"Person","name":"Jun"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://rich-junwang.github.io/en-us/posts/tech/ml_infra/kubenetes/basics/"},"publisher":{"@type":"Organization","name":"Jun's Blog","logo":{"@type":"ImageObject","url":"https://rich-junwang.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://rich-junwang.github.io/en-us/ accesskey=h title="Jun's Blog (Alt + H)"><img src=https://rich-junwang.github.io/img/Q.gif alt=logo aria-label=logo height=35>Jun's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://rich-junwang.github.io/en-us/ title="ğŸ  Home"><span>ğŸ  Home</span></a></li><li><a href=https://rich-junwang.github.io/en-us/about title="ğŸ™‹ğŸ»â€â™‚ï¸ About"><span>ğŸ™‹ğŸ»â€â™‚ï¸ About</span></a></li><li><a href=https://rich-junwang.github.io/en-us/posts title="ğŸ“š Posts"><span>ğŸ“š Posts</span></a></li><li><a href=https://rich-junwang.github.io/en-us/tags title="ğŸ§© Tags"><span>ğŸ§© Tags</span></a></li><li><a href=https://rich-junwang.github.io/en-us/archives/ title="â±ï¸ Archives"><span>â±ï¸ Archives</span></a></li><li><a href=https://rich-junwang.github.io/en-us/search title="ğŸ” Search (Alt + /)" accesskey=/><span>ğŸ” Search</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://rich-junwang.github.io/en-us/>ğŸ  Home</a>&nbsp;Â»&nbsp;<a href=https://rich-junwang.github.io/en-us/posts/>ğŸ“šArticles</a>&nbsp;Â»&nbsp;<a href=https://rich-junwang.github.io/en-us/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» Tech</a></div><h1 class=post-title>Kubernetes</h1><div class=post-description>Kubenetes is everywhere.</div><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2022-12-08
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>652 words
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>2 min
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>Jun
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta></span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://rich-junwang.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><figure class=entry-cover1><img style=zoom: loading=lazy src=https://rich-junwang.github.io/images/speedup.jpg alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#basics aria-label=Basics>Basics</a></li><li><a href=#basic-operations aria-label="Basic Operations">Basic Operations</a></li></ul><li><a href=#eks aria-label=EKS>EKS</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h3 id=basics>Basics<a hidden class=anchor aria-hidden=true href=#basics>#</a></h3><p>Kubernetes, also known as â€œk8sâ€, is an open source platform solution provided by Google for scheduling and automating the deployment, management, and scaling of containerized applications. Kubernetes has the ability of scheduling and running application containers on a cluster of physical or virtual machines. In managing the applications, the concepts of &rsquo;labels&rsquo; and &lsquo;pods&rsquo; are used to group the containers which make up an application. Currently, it supports Docker for containers.</p><p align=center><img alt="gopher dataset" src=images/kubernetes.png width=80%><br><em>kubernetes architecture, image from [1]</em><br></p><p>Pod is a type of abstraction on top of container. Deployment defines the pod. Deployment is used for stateless apps and StatefulSet is used for stateful apps or database. KubeCTL talks with API server to create components or delete components, in other words configuring the cluster. More about this basics is <a href="https://www.youtube.com/watch?v=X48VuDVv0do&amp;t=2749s">here</a></p><h3 id=basic-operations>Basic Operations<a hidden class=anchor aria-hidden=true href=#basic-operations>#</a></h3><p>To find out all the pods, using the following command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods 
</span></span><span style=display:flex><span>kubectl get pods | grep username 
</span></span><span style=display:flex><span>kubectl get pods -n my_namespace_name  <span style=color:#75715e># get pod understand a </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get all the nodes</span>
</span></span><span style=display:flex><span>kubectl get nodes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get services</span>
</span></span><span style=display:flex><span>kubectl get services
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create deployment. (blueprint of pod)</span>
</span></span><span style=display:flex><span>kubectl create deployment my_pod_name --image<span style=color:#f92672>=</span>my_image
</span></span><span style=display:flex><span>kubectl get deployment
</span></span><span style=display:flex><span>kubectl delete deployment deployment_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Log into the pod</span>
</span></span><span style=display:flex><span>kubectl exec -it my_pod_name -- /bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># describe a pod</span>
</span></span><span style=display:flex><span>kubectl describe pods
</span></span><span style=display:flex><span>kubectl describe pod my_pod_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get pod config</span>
</span></span><span style=display:flex><span>kubectl get pod my_pod_name -o yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># delete a pod</span>
</span></span><span style=display:flex><span>kubectl delete Pod my_pod_name
</span></span></code></pre></div><p>To get all the containers running the pod, using the following command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods my_pod_name -o custom-columns<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;NAME:.metadata.name,CONTAINERS:.spec.containers[*].name&#39;</span>
</span></span><span style=display:flex><span>kubectl describe pod my_pod_name  -n my_namespace_name
</span></span><span style=display:flex><span><span style=color:#75715e># To get ip. The ip can be used to launch distributed runs.</span>
</span></span><span style=display:flex><span>kubectl get pod my_pod_name --template <span style=color:#e6db74>&#39;{{.status.podIP}}&#39;</span>
</span></span></code></pre></div><p>View logs of job running in the pod</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs my_pod_name
</span></span><span style=display:flex><span>kubectl logs -f my_pod_name <span style=color:#75715e># similar to attach</span>
</span></span><span style=display:flex><span>kubectl attach my_pod_name  <span style=color:#75715e># works with tqdm </span>
</span></span></code></pre></div><p>Deploy a k8s job</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># deploy</span>
</span></span><span style=display:flex><span>kubectl apply -f ./job.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># delete</span>
</span></span><span style=display:flex><span>kubectl delete -f ./job.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># describe</span>
</span></span><span style=display:flex><span>kubectl describe -f ./job.yaml
</span></span></code></pre></div><p>When we want to delete kubernetes created resources, it&rsquo;s important to remember the dependencies of the resources. For instance, to delete a fsx app, we have to do the following in order</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod --all
</span></span><span style=display:flex><span>kubectl delete pvc --all
</span></span><span style=display:flex><span>kubectl delete pv --all
</span></span></code></pre></div><p>We can use <code>kubectl</code> to copy files to/from the pod. Be careful that your container may not support <code>~</code> this kind of path expansion.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl cp src_file_path pod:dest_file_path
</span></span></code></pre></div><p>To use rsync is not that straightforward, I&rsquo;m using the tool from <a href=https://serverfault.com/questions/741670/rsync-files-to-a-kubernetes-pod>here</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># save the file as krsync, and put it to /usr/bin, and chmod +x to the file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$KRSYNC_STARTED<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    export KRSYNC_STARTED<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>    exec rsync --blocking-io --rsh <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span> $@
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Running as --rsh</span>
</span></span><span style=display:flex><span>namespace<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>pod<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>shift
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># If use uses pod@namespace rsync passes as: {us} -l pod namespace ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;X</span>$pod<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;X-l&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    pod<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>    shift
</span></span><span style=display:flex><span>    namespace<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-n </span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    shift
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exec kubectl $namespace exec -i $pod -- <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>Then use the following command to sync files. Note that you have to install <code>rsync</code> on the pod.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>krsync -av --progress --stats src-dir/ pod:/dest-dir
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># with namespace</span>
</span></span><span style=display:flex><span>krsync -av --progress --stats src-dir/ pod@namespace:/dest-dir
</span></span></code></pre></div><p>To make it easier to use, we can add the following to the .zshrc file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>function</span> krsync_watch_and_sync_to <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        fswatch -o . | xargs -n1 -I<span style=color:#f92672>{}</span> krsync -av --progress --stats *<span style=color:#f92672>(</span>D<span style=color:#f92672>)</span>  $1
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Sometimes we have to change file ownership. Check out more <a href=https://vhs.codeberg.page/post/recover-files-kubernetes-persistent-volume/>here</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown -R 33:33 /data/uploads
</span></span></code></pre></div><p>When we want to log into multiple pods, we can use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>xpanes -c <span style=color:#e6db74>&#34;kubectl exec -it {} -- /bin/bash &#34;</span> <span style=color:#66d9ef>$(</span>kubectl get pods | grep my_pod_prefixes | cut -d<span style=color:#e6db74>&#34; &#34;</span> -f1 | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h2 id=eks>EKS<a hidden class=anchor aria-hidden=true href=#eks>#</a></h2><p>AWS has managed kubenetes service called EKS.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create a basic cluster</span>
</span></span><span style=display:flex><span>eksctl create cluster
</span></span><span style=display:flex><span>eksctl create cluster -f ./my_eks.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># get details of a cluster</span>
</span></span><span style=display:flex><span>eksctl get cluster --name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;my_cluster_1&#34;</span> --region<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;us-west-2&#34;</span>
</span></span></code></pre></div><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ol><li><a href=https://callistaenterprise.se/blogg/teknik/2017/12/20/kubernetes-on-docker-in-docker/>Setting up a Kubernetes cluster using Docker in Docker</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/>https://kubernetes.io/docs/reference/kubectl/cheatsheet/</a></li><li><a href=https://catalog.workshops.aws/sagemaker-hyperpod-eks/en-US>https://catalog.workshops.aws/sagemaker-hyperpod-eks/en-US</a></li><li><a href=https://catalog.workshops.aws/sagemaker-hyperpod/en-US>https://catalog.workshops.aws/sagemaker-hyperpod/en-US</a></li><li><a href=https://github.com/aws-samples/aws-do-ray>https://github.com/aws-samples/aws-do-ray</a></li></ol></div><footer class=post-footer><nav class=paginav><a class=prev href=https://rich-junwang.github.io/en-us/posts/tech/llm/large_scale_pretraining/pretrain/><span class=title>Â«</span><br><span>Large Scale Pretraining</span>
</a><a class=next href=https://rich-junwang.github.io/en-us/posts/tech/antlr/><span class=title>Â»</span><br><span>ANTLR Parser Generator</span></a></nav></footer></div><style>.comments_details summary::marker{font-size:20px;content:'ğŸ‘‰Comment';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'ğŸ‘‡Collapse';color:var(--content)}</style><div><details class=comments_details><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>twikoo.init({envId:null,el:"#tcomment",lang:"en-us",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2025
<a href=https://rich-junwang.github.io/en-us/ style=color:#939393>Jun's Blog</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒJun's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`\r

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒJun's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function i(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`\r
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒJun's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>